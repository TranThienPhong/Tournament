<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>S∆° ƒê·ªì Thi ƒê·∫•u 75 ƒê·ªôi</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    import React, { useState } from 'react';

    export default function TournamentBracket() {
      const [teams, setTeams] = useState(
        Array.from({ length: 75 }, (_, i) => `ƒê·ªôi ${i + 1}`)
      );
      const [matches, setMatches] = useState([]);
      const [generated, setGenerated] = useState(false);

      const generateBracket = () => {
        const shuffled = [...teams].sort(() => Math.random() - 0.5);
        const newMatches = [];
        let matchId = 1;

        // V√≤ng 1: 75 ƒë·ªôi -> c·∫ßn 38 tr·∫≠n (37 tr·∫≠n ƒë·∫•u lo·∫°i + 1 ƒë·ªôi bye)
        // 75 = 2^6 + 11, n√™n c·∫ßn lo·∫°i 11 ƒë·ªôi ƒë·ªÉ c√≤n 64 ƒë·ªôi
        // V·∫≠y v√≤ng 1 c√≥ 11 tr·∫≠n, 53 ƒë·ªôi v√†o th·∫≥ng v√≤ng 2

        const round1Teams = shuffled.slice(0, 22); // 22 ƒë·ªôi ƒë√° v√≤ng 1
        const byeTeams = shuffled.slice(22); // 53 ƒë·ªôi v√†o th·∫≥ng v√≤ng 2

        // V√≤ng 1: 11 tr·∫≠n
        for (let i = 0; i < round1Teams.length; i += 2) {
          newMatches.push({
            id: matchId++,
            round: 1,
            team1: round1Teams[i],
            team2: round1Teams[i + 1],
            score1: '',
            score2: '',
            winner: '',
            note: ''
          });
        }

        // V√≤ng 2: 53 + 11 = 64 ƒë·ªôi -> 32 tr·∫≠n
        const round2Count = 32;
        for (let i = 0; i < round2Count; i++) {
          newMatches.push({
            id: matchId++,
            round: 2,
            team1: i < byeTeams.length ? byeTeams[i] : 'Ch·ªù v√≤ng 1',
            team2: 'Ch·ªù v√≤ng 1',
            score1: '',
            score2: '',
            winner: '',
            note: ''
          });
        }

        // V√≤ng 3: 32 ƒë·ªôi -> 16 tr·∫≠n
        for (let i = 0; i < 16; i++) {
          newMatches.push({
            id: matchId++,
            round: 3,
            team1: 'Ch·ªù v√≤ng 2',
            team2: 'Ch·ªù v√≤ng 2',
            score1: '',
            score2: '',
            winner: '',
            note: ''
          });
        }

        // V√≤ng 4: 16 ƒë·ªôi -> 8 tr·∫≠n
        for (let i = 0; i < 8; i++) {
          newMatches.push({
            id: matchId++,
            round: 4,
            team1: 'Ch·ªù v√≤ng 3',
            team2: 'Ch·ªù v√≤ng 3',
            score1: '',
            score2: '',
            winner: '',
            note: ''
          });
        }

        // T·ª© k·∫øt: 8 ƒë·ªôi -> 4 tr·∫≠n
        for (let i = 0; i < 4; i++) {
          newMatches.push({
            id: matchId++,
            round: 'T·ª© k·∫øt',
            team1: 'Ch·ªù v√≤ng 4',
            team2: 'Ch·ªù v√≤ng 4',
            score1: '',
            score2: '',
            winner: '',
            note: ''
          });
        }

        // B√°n k·∫øt: 4 ƒë·ªôi -> 2 tr·∫≠n
        for (let i = 0; i < 2; i++) {
          newMatches.push({
            id: matchId++,
            round: 'B√°n k·∫øt',
            team1: 'Ch·ªù t·ª© k·∫øt',
            team2: 'Ch·ªù t·ª© k·∫øt',
            score1: '',
            score2: '',
            winner: '',
            note: ''
          });
        }

        // Chung k·∫øt
        newMatches.push({
          id: matchId++,
          round: 'Chung k·∫øt',
          team1: 'Ch·ªù b√°n k·∫øt',
          team2: 'Ch·ªù b√°n k·∫øt',
          score1: '',
          score2: '',
          winner: '',
          note: ''
        });

        setMatches(newMatches);
        setGenerated(true);
      };

      const updateMatch = (id, field, value) => {
        setMatches(prev => prev.map(m =>
          m.id === id ? { ...m, [field]: value } : m
        ));
      };

      const exportToCSV = () => {
        let csv = 'Tr·∫≠n ƒë·∫•u,V√≤ng,ƒê·ªôi 1,T·ª∑ s·ªë 1,ƒê·ªôi 2,T·ª∑ s·ªë 2,ƒê·ªôi th·∫Øng,Ghi ch√∫\n';

        matches.forEach(m => {
          const row = [
            `Tr·∫≠n ${m.id}`,
            m.round,
            m.team1,
            m.score1,
            m.team2,
            m.score2,
            m.winner,
            m.note
          ].map(cell => `"${cell}"`).join(',');
          csv += row + '\n';
        });

        // Th√™m BOM ƒë·ªÉ Excel hi·ªÉn th·ªã ƒë√∫ng ti·∫øng Vi·ªát
        const BOM = '\uFEFF';
        const blob = new Blob([BOM + csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);

        link.setAttribute('href', url);
        link.setAttribute('download', 'So_do_thi_dau_75_doi.csv');
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      };

      const exportToExcel = () => {
        // T·∫°o HTML table ƒë·ªÉ Excel c√≥ th·ªÉ m·ªü
        let html = `
      <html xmlns:x="urn:schemas-microsoft-com:office:excel">
      <head>
        <meta charset="UTF-8">
        <style>
          table { border-collapse: collapse; width: 100%; }
          th, td { border: 1px solid black; padding: 8px; text-align: left; }
          th { background-color: #4F46E5; color: white; font-weight: bold; }
        </style>
      </head>
      <body>
        <table>
          <thead>
            <tr>
              <th>Tr·∫≠n ƒë·∫•u</th>
              <th>V√≤ng</th>
              <th>ƒê·ªôi 1</th>
              <th>T·ª∑ s·ªë 1</th>
              <th>ƒê·ªôi 2</th>
              <th>T·ª∑ s·ªë 2</th>
              <th>ƒê·ªôi th·∫Øng</th>
              <th>Ghi ch√∫</th>
            </tr>
          </thead>
          <tbody>
    `;

        matches.forEach(m => {
          html += `
        <tr>
          <td>Tr·∫≠n ${m.id}</td>
          <td>${m.round}</td>
          <td>${m.team1}</td>
          <td>${m.score1}</td>
          <td>${m.team2}</td>
          <td>${m.score2}</td>
          <td>${m.winner}</td>
          <td>${m.note}</td>
        </tr>
      `;
        });

        html += `
          </tbody>
        </table>
      </body>
      </html>
    `;

        const blob = new Blob([html], { type: 'application/vnd.ms-excel' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);

        link.setAttribute('href', url);
        link.setAttribute('download', 'So_do_thi_dau_75_doi.xls');
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
          <div className="max-w-7xl mx-auto">
            <h1 className="text-4xl font-bold text-center text-indigo-900 mb-8">
              S∆° ƒê·ªì Thi ƒê·∫•u 75 ƒê·ªôi
            </h1>

            <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
              <div className="flex gap-4 justify-center flex-wrap">
                <button
                  onClick={generateBracket}
                  className="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg font-semibold transition"
                >
                  üé≤ T·∫°o S∆° ƒê·ªì Thi ƒê·∫•u
                </button>

                {generated && (
                  <>
                    <button
                      onClick={exportToExcel}
                      className="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold transition"
                    >
                      üìä Xu·∫•t File Excel (.xls)
                    </button>
                    <button
                      onClick={exportToCSV}
                      className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition"
                    >
                      üìÑ Xu·∫•t File CSV
                    </button>
                  </>
                )}
              </div>
            </div>

            {generated && (
              <div className="bg-white rounded-lg shadow-lg p-6">
                <div className="mb-4 flex justify-between items-center">
                  <h2 className="text-2xl font-bold text-gray-800">
                    Danh s√°ch tr·∫≠n ƒë·∫•u: {matches.length} tr·∫≠n
                  </h2>
                </div>

                <div className="overflow-x-auto">
                  <table className="w-full border-collapse">
                    <thead>
                      <tr className="bg-indigo-600 text-white">
                        <th className="p-3 text-left border">Tr·∫≠n</th>
                        <th className="p-3 text-left border">V√≤ng</th>
                        <th className="p-3 text-left border">ƒê·ªôi 1</th>
                        <th className="p-3 text-center border">T·ª∑ s·ªë</th>
                        <th className="p-3 text-left border">ƒê·ªôi 2</th>
                        <th className="p-3 text-left border">ƒê·ªôi th·∫Øng</th>
                        <th className="p-3 text-left border">Ghi ch√∫</th>
                      </tr>
                    </thead>
                    <tbody>
                      {matches.map(match => (
                        <tr key={match.id} className="hover:bg-gray-50">
                          <td className="p-3 border font-semibold">{match.id}</td>
                          <td className="p-3 border">
                            <span className="bg-indigo-100 text-indigo-800 px-2 py-1 rounded text-sm">
                              {match.round}
                            </span>
                          </td>
                          <td className="p-3 border">{match.team1}</td>
                          <td className="p-3 border">
                            <div className="flex gap-2 items-center justify-center">
                              <input
                                type="text"
                                value={match.score1}
                                onChange={(e) => updateMatch(match.id, 'score1', e.target.value)}
                                className="w-12 p-1 border rounded text-center"
                                placeholder="0"
                              />
                              <span className="font-bold">-</span>
                              <input
                                type="text"
                                value={match.score2}
                                onChange={(e) => updateMatch(match.id, 'score2', e.target.value)}
                                className="w-12 p-1 border rounded text-center"
                                placeholder="0"
                              />
                            </div>
                          </td>
                          <td className="p-3 border">{match.team2}</td>
                          <td className="p-3 border">
                            <input
                              type="text"
                              value={match.winner}
                              onChange={(e) => updateMatch(match.id, 'winner', e.target.value)}
                              className="w-full p-1 border rounded"
                              placeholder="ƒê·ªôi th·∫Øng"
                            />
                          </td>
                          <td className="p-3 border">
                            <input
                              type="text"
                              value={match.note}
                              onChange={(e) => updateMatch(match.id, 'note', e.target.value)}
                              className="w-full p-1 border rounded"
                              placeholder="Ghi ch√∫..."
                            />
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </div>
            )}

            {!generated && (
              <div className="bg-white rounded-lg shadow-lg p-12 text-center">
                <div className="text-6xl mb-4">üèÜ</div>
                <p className="text-gray-600 text-lg">
                  Nh·∫•n "T·∫°o S∆° ƒê·ªì Thi ƒê·∫•u" ƒë·ªÉ b·∫Øt ƒë·∫ßu
                </p>
              </div>
            )}
          </div>
        </div>
      );
    }
  </script>
</body>

</html>